<section class="max-w-6xl mx-auto p-4">
  <div class="relative overflow-hidden rounded-xl bg-gradient-to-b from-brand-50 to-white dark:from-gray-800 dark:to-gray-900 border border-gray-200 dark:border-gray-800 p-6 mb-6">
    <h1 class="text-3xl sm:text-4xl font-bold mb-2 tracking-tight">What Should I Watch Tonight?</h1>
    <p class="text-gray-600 dark:text-gray-300 mb-4 max-w-2xl">Pick a mood to get curated suggestions, or head to search to find exactly what you want.</p>

    <div class="flex flex-wrap gap-2">
      <button type="button" class="px-3 py-2 rounded-full border border-gray-300 dark:border-gray-700 hover:border-brand-600 hover:text-brand-700 dark:hover:text-brand-50 transition"
              [class.bg-brand-600]="selectedMood() === 'feel-good'"
              [class.text-white]="selectedMood() === 'feel-good'"
              [disabled]="loading()"
              (click)="selectMood('feel-good')">Feel Good</button>
      <button type="button" class="px-3 py-2 rounded-full border border-gray-300 dark:border-gray-700 hover:border-brand-600 hover:text-brand-700 dark:hover:text-brand-50 transition"
              [class.bg-brand-600]="selectedMood() === 'action-fix'"
              [class.text-white]="selectedMood() === 'action-fix'"
              [disabled]="loading()"
              (click)="selectMood('action-fix')">Action Fix</button>
      <button type="button" class="px-3 py-2 rounded-full border border-gray-300 dark:border-gray-700 hover:border-brand-600 hover:text-brand-700 dark:hover:text-brand-50 transition"
              [class.bg-brand-600]="selectedMood() === 'mind-benders'"
              [class.text-white]="selectedMood() === 'mind-benders'"
              [disabled]="loading()"
              (click)="selectMood('mind-benders')">Mind Benders</button>

      <a routerLink="/search" class="ml-auto inline-flex items-center gap-2 text-sm underline-offset-4 hover:underline">Go to Search â†’</a>
    </div>

    <div class="pointer-events-none absolute -right-10 -top-10 h-40 w-40 rounded-full bg-brand-600/10 blur-2xl"></div>
  </div>

  <div class="relative min-h-[400px]">
    @if (loading()) {
      <div class="absolute inset-0 flex items-center justify-center">
        <div class="flex flex-col items-center gap-4">
          <div class="w-8 h-8 border-2 border-brand-600 border-t-transparent rounded-full animate-spin"></div>
          <p class="text-gray-600 dark:text-gray-400">Loading movies...</p>
        </div>
      </div>
    } @else if (error()) {
      <div class="p-6 text-red-600 text-center">{{ error() }}</div>
    } @else if (movies().length) {
      <div class="transition-opacity duration-300" [class.opacity-0]="loading()">
        <app-row title="Top picks for your mood">
          @for (m of movies(); track m.id; let idx = $index) {
            <div class="relative flex-none w-[180px] sm:w-[200px] min-w-[180px] sm:min-w-[200px] snap-start">
              <div class="absolute -left-2 -top-2 z-10 text-lg font-bold text-gray-800 dark:text-gray-200 drop-shadow">{{ idx + 1 }}.</div>
              <app-movie-card [id]="m.id" [title]="m.title" [posterPath]="m.poster_path" [releaseDate]="m.release_date" [voteAverage]="m.vote_average" [compact]="true" />
            </div>
          }
          
          <!-- Loading More Indicator at End of Row -->
          @if (hasMorePages()) {
            <div class="flex-none w-[180px] sm:w-[200px] min-w-[180px] sm:min-w-[200px] snap-start flex items-center justify-center">
              <button 
                (click)="loadMore()" 
                [disabled]="loadingMore()"
                class="w-full h-full min-h-[270px] flex flex-col items-center justify-center bg-gray-50 dark:bg-gray-800 rounded-lg border-2 border-dashed border-gray-300 dark:border-gray-600 hover:border-brand-600 dark:hover:border-brand-400 transition-colors"
              >
                @if (loadingMore()) {
                  <div class="w-8 h-8 border-2 border-brand-600 border-t-transparent rounded-full animate-spin mb-2"></div>
                  <p class="text-sm text-gray-600 dark:text-gray-400">Loading...</p>
                } @else {
                  <svg class="w-8 h-8 text-gray-400 dark:text-gray-500 mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                  </svg>
                  <p class="text-sm text-gray-600 dark:text-gray-400">Load More</p>
                }
              </button>
            </div>
          }
        </app-row>
        
        <!-- End of Results -->
        @if (!hasMorePages() && movies().length > 0) {
          <div class="text-center py-8">
            <p class="text-sm text-gray-500 dark:text-gray-400">You've reached the end of the results</p>
          </div>
        }
      </div>
    } @else {
      <div class="p-6 text-gray-600 text-center">No results.</div>
    }
  </div>
</section> 